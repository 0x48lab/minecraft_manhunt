# Minecraft Manhunt プラグイン仕様書

## 概要
Minecraft Manhuntは、複数のプレイヤーがハンター（追う人）とランナー（逃げる人）に分かれて行う対戦型ゲームプラグインです。

## ゲーム目標
- **ランナー（逃げる人）**: エンダードラゴンを倒すことで勝利
- **ハンター（追う人）**: ランナーを全員倒すことで勝利

## プレイヤー役割

### PlayerRole（役割）
1. **RUNNER（逃げる人）**
   - エンダードラゴン討伐が目標
   - ハンターに追跡される
   - 近接警告システムで危険を通知

2. **HUNTER（追う人）**
   - ランナーを追跡・討伐が目標
   - 追跡コンパスでランナーの位置を把握

3. **SPECTATOR（観戦者）**
   - ゲームには参加せず観戦のみ
   - ゲーム進行中は自動的にSpectatorモードに設定

## ゲーム状態管理

### GameState（ゲーム状態）
- **WAITING**: ゲーム開始待機中
- **STARTING**: ゲーム開始処理中
- **RUNNING**: ゲーム進行中
- **ENDED**: ゲーム終了

## コマンド仕様

### 基本コマンド
- `/manhunt join [runner|hunter|spectator]` - ゲームに参加
- `/manhunt leave` - ゲームから退出
- `/manhunt role <runner|hunter|spectator>` - 役割変更（待機中のみ）
- `/manhunt compass` - 追跡コンパス取得（ハンターのみ、ゲーム中のみ）
- `/manhunt status` - ゲーム状況確認
- `/manhunt help` - ヘルプ表示

### 管理者コマンド（manhunt.admin権限）
- `/manhunt start` - ゲーム強制開始
- `/manhunt sethunter <プレイヤー>` - 指定プレイヤーをハンターに設定
- `/manhunt minplayers [数値]` - 最小プレイヤー数設定・確認
- `/manhunt reload` - 設定ファイルをリロード

## システム機能

### 1. 追跡コンパス
- ハンターが使用可能
- 最も近いランナーの位置を指す
- 同一ワールド内でのみ動作
- 毎秒更新

### 2. 近接警告システム
- ランナーに危険を通知
- チャンク単位での距離計算
  - 1チャンク以内: 赤色警告
  - 2チャンク以内: 橙色警告  
  - 3チャンク以内: 黄色警告

### 3. 自動ゲーム開始
- 最小プレイヤー数（デフォルト2人）以上
- ハンターとランナーが最低1人ずつ必要

### 4. ネットワーク切断対応
- ゲーム中の切断プレイヤーの役割を保持
- 再接続時に元の役割で復帰可能
- 意図的な退出は観戦者に変更

### 5. ゲームモード管理
- ゲーム開始前のモードを保存
- ゲーム中は参加者をSpectatorモードに設定
- ゲーム終了後に元のモードに復元

## 勝利条件

### ランナー勝利
- エンダードラゴンを倒した場合
- ハンターが全員退出した場合

### ハンター勝利
- ランナーを全員倒した場合
- ランナーが全員退出した場合

## 設定ファイル（config.yml）

### ゲーム設定
```yaml
game:
  min-players: 2                    # 最小プレイヤー数
  proximity-warning:
    level-1: 1                      # 1チャンク警告
    level-2: 2                      # 2チャンク警告
    level-3: 3                      # 3チャンク警告
    cooldown-seconds: 5             # 警告頻度制御（秒）
  compass-update-interval: 1        # コンパス更新間隔（秒）
  proximity-check-interval: 1       # 近接チェック間隔（秒）
  respawn:
    runner-respawn-time: 300        # ランナーリスポン時間（秒）
    hunter-instant-respawn: true    # ハンター即座リスポン
```

### UI設定
```yaml
ui:
  scoreboard-enabled: true          # スコアボード表示
  actionbar-enabled: true           # ActionBar表示
  bossbar-enabled: true             # BossBar表示
  title-enabled: true               # タイトル表示
  scoreboard-update-interval: 1     # スコアボード更新間隔（秒）
  actionbar-update-interval: 2      # ActionBar更新間隔（秒）
  distance-display:
    minimum-distance: 5             # 最小距離表示（メートル）
```

### メッセージ設定
```yaml
messages:
  game-start: "§6[Manhunt] ゲーム開始！"
  hunter-win: "§c追う人の勝利！逃げる人を全員倒しました！"
  runner-win: "§a逃げる人の勝利！エンダードラゴンを倒しました！"
  proximity-warnings:
    level-1: "§c§l[警告] 追う人が1チャンク以内にいます！"
```

## クラス構成

### Core Classes
- `Main.kt` - プラグインメインクラス
- `GameManager.kt` - ゲーム状態・プレイヤー管理
- `CompassTracker.kt` - コンパス追跡システム
- `EventListener.kt` - イベント処理
- `ManhuntCommand.kt` - コマンド処理

### Data Classes
- `GameState.kt` - ゲーム状態列挙型
- `PlayerRole.kt` - プレイヤー役割列挙型・データクラス

## 権限設定
- `manhunt.admin` - 管理者権限（デフォルト: OP）
- `manhunt.use` - 基本使用権限（デフォルト: true）

## 技術仕様
- **対応バージョン**: Minecraft 1.21.4
- **プラットフォーム**: Spigot/Paper
- **言語**: Kotlin 1.9.24
- **ビルドツール**: Gradle 8.8
- **JVM**: Java 21

## 死亡・リスポンルール

### ハンター（追う人）の死亡
- **即座リスポン**: 死亡後1tick（約0.05秒）で自動リスポン
- **ゲームモード**: サバイバルモードを維持
- **制限**: リスポン回数制限なし
- **メッセージ**: 「[ハンター] リスポンしました！追跡を続けてください。」

### ランナー（逃げる人）の死亡
- **リスポン待機時間**: 設定可能（デフォルト300秒）
- **待機中の状態**:
  - 1秒後に自動的にスペクテーターモードに変更
  - ゲーム全体を自由に観戦可能
  - 飛行モードで制限なく移動
  - リアルタイムカウントダウン表示（タイトル）
- **リスポン時の処理**:
  - 自動的にサバイバルモードに復帰
  - 元の場所または安全な場所にリスポン
  - 「[ランナー] リスポンしました！エンダードラゴンを倒してください。」

### 勝利条件への影響
- **ハンター勝利**: 全ランナーが死亡した瞬間に即座にゲーム終了
- **ランナー勝利**: エンダードラゴンを倒した場合、または全ハンターが退出した場合
- **即座終了**: リスポン待ち時間に関係なく、生存ランナーが0人になった時点で終了

### UI表示
- **スコアボード**: 「リスポン待ち: X人」表示
- **カウントダウン**: 「💀 死亡中 - X秒後にリスポン」
- **音響効果**: 最後の3秒間でカウントダウン音
- **視覚強調**: 残り3秒で「3...」「2...」「1...」表示

## UI・表示システム

### ActionBar表示
- **ハンター**: 「🗡 ハンターモード | 最寄りターゲット: [名前] ([距離]m)」
- **ランナー**: 「🏃 ランナーモード | エンダードラゴンを倒そう！」
- **観戦者**: 「👁 観戦モード | ゲームを観戦中...」

### 距離表示システム
- **ハンター専用**: 最寄りランナーとの距離を表示
- **ランナー**: ハンターの距離は**非表示**（ゲームバランス調整）
- **最小距離設定**: 設定値未満の距離は設定値で表示（デフォルト5m）

### 近接警告システム
- **対象**: ランナーのみ
- **警告レベル**: 1・2・3チャンク以内の段階的警告
- **頻度制御**: 同じプレイヤーへの警告は設定秒数間隔（デフォルト5秒）
- **目的**: 警告スパムを防止し、快適なゲームプレイを提供

## 注意事項
- ゲーム進行中の新規ログインプレイヤーは自動的に観戦者モードになります
- ゲーム終了後は10秒後に自動的にリセットされます
- 同一ワールド内でのみ追跡機能が動作します
- リスポン待ち中のランナーは完全に観戦可能で、ゲームの流れを把握できます